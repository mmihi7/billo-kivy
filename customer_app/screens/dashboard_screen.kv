<DashboardScreen>:
    name: 'dashboard'
    
    BoxLayout:
        id: main_layout
        orientation: 'vertical'
        
        # App Bar
        MDTopAppBar:
            id: appbar
            title: "Billo"
            elevation: 10
            left_action_items: [['menu', lambda x: app.root.toggle_nav_drawer()]]
            right_action_items: [['refresh', lambda x: root.refresh_data()], ['logout', lambda x: root.logout()]]
            md_bg_color: app.theme_cls.primary_color
            specific_text_color: 1, 1, 1, 1
        
        # Main Content
        ScrollView:
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(20)
                padding: dp(16)
                size_hint_y: None
                height: self.minimum_height
                
                # Welcome Section
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(120)
                    spacing: dp(10)
                    padding: [0, dp(10), 0, dp(10)]
                    
                    MDLabel:
                        text: f"Welcome back, {root.user_name}"
                        font_style: 'H5'
                        theme_text_color: 'Primary'
                        size_hint_y: None
                        height: self.texture_size[1]
                        halign: 'center'
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint: None, None
                        size: dp(400), dp(48)
                        pos_hint: {'center_x': 0.5}
                        spacing: dp(10)
                        
                        MDRaisedButton:
                            id: connect_button
                            text: 'Connect to Restaurant'
                            icon: 'store-plus'
                            size_hint_x: 0.6
                            on_release: root.on_connect_restaurant()
                            md_bg_color: app.theme_cls.primary_light
                            text_color: 0, 0, 0, 1
                            
                        MDRaisedButton:
                            id: scan_button
                            text: 'Scan QR'
                            icon: 'qrcode-scan'
                            size_hint_x: 0.4
                            on_release: root.on_scan_qr()
                            md_bg_color: app.theme_cls.primary_color
                        disabled: root.loading
                        opacity: 0 if root.loading else 1
                        disabled_opacity: 0.5
                
                # Active Tabs Section
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(300)
                    spacing: dp(10)
                    
                    BoxLayout:
                        size_hint_y: None
                        height: dp(40)
                        spacing: dp(10)
                        
                        MDLabel:
                            text: 'Active Tabs'
                            font_style: 'H6'
                            theme_text_color: 'Primary'
                            size_hint_x: 0.7
                            
                        MDTextButton:
                            text: 'View All'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_color
                            on_release: root.on_view_all_tabs()
                            size_hint_x: 0.3
                            pos_hint: {'center_y': 0.5}
                    
                    # Active Tabs List
                    ScrollView:
                        size_hint_y: None
                        height: dp(250)
                        do_scroll_x: False
                        
                        MDGridLayout:
                            id: active_tabs_list
                            cols: 1
                            spacing: dp(10)
                            size_hint_y: None
                            height: self.minimum_height
                            padding: dp(10)
                            
                            # Placeholder for tabs (will be populated in Python)
                            MDLabel:
                                id: no_tabs_label
                                text: 'No active tabs found.'
                                theme_text_color: 'Secondary'
                                halign: 'center'
                                valign: 'center'
                                size_hint_y: None
                                height: dp(100)
                                size_hint_x: 1
                
                # Recent Activity Section
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(250)
                    spacing: dp(10)
                    
                    BoxLayout:
                        size_hint_y: None
                        height: dp(40)
                        spacing: dp(10)
                        
                        MDLabel:
                            text: 'Recent Activity'
                            font_style: 'H6'
                            theme_text_color: 'Primary'
                            size_hint_x: 0.7
                            
                        MDTextButton:
                            text: 'View All'
                            theme_text_color: 'Custom'
                            text_color: app.theme_cls.primary_color
                            on_release: root.on_view_all_activity()
                            size_hint_x: 0.3
                            pos_hint: {'center_y': 0.5}
                    
                    # Activity List
                    RecycleView:
                        id: activity_list
                        viewclass: 'MDListItem'
                        
                        RecycleBoxLayout:
                            default_size: None, dp(72)
                            default_size_hint: 1, None
                            size_hint_y: None
                            height: self.minimum_height
                            orientation: 'vertical'
                            spacing: dp(5)
        
        # Loading Overlay
        # Loading Overlay
        MDBoxLayout:
            id: loading_overlay
            size_hint: 1, 1
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            md_bg_color: [0, 0, 0, 0.5]
            opacity: 0
            disabled: True
            
            canvas.before:
                Color:
                    rgba: self.md_bg_color
                RoundedRectangle:
                    size: self.size
                    pos: self.pos
                    radius: [0, 0, 0, 0]
            
            MDBoxLayout:
                orientation: 'vertical'
                size_hint: None, None
                size: dp(200), dp(100)
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                spacing: dp(10)
                padding: dp(20)
                md_bg_color: [1, 1, 1, 1]
                radius: [10,]
                
                MDSpinner:
                    size_hint: None, None
                    size: dp(46), dp(46)
                    pos_hint: {'center_x': 0.5}
                    active: root.loading
                    palette: [
                    app.theme_cls.primary_color,
                    app.theme_cls.primary_light,
                    app.theme_cls.primary_dark,
                    ]
                
                MDLabel:
                    id: loading_label
                    text: 'Loading...'
                    theme_text_color: 'Primary'
                    halign: 'center'
                    size_hint_y: None
                    height: self.texture_size[1]
            opacity: 1 if root.loading else 0
            disabled: not root.loading
            
            MDSpinner:
                size_hint: None, None
                size: dp(46), dp(46)
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                active: root.loading
                
                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1
                    Ellipse:
                        size: self.size
                        pos: self.pos

<TabCard>:
    orientation: 'vertical'
    size_hint: 1, None
    height: dp(120)
    padding: dp(15)
    spacing: dp(5)
    radius: [10,]
    elevation: 2
    ripple_behavior: True
    
    canvas.before:
        Color:
            rgba: app.theme_cls.primary_light if self.status == 'active' else [0.9, 0.9, 0.9, 1]
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [10,]
    
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: dp(30)
        
        MDLabel:
            text: f"Tab #{root.tab_number}"
            font_style: 'Subtitle1'
            bold: True
            theme_text_color: 'Primary'
            size_hint_x: 0.7
            
        MDChip:
            id: status_chip
            text: root.status.upper()
            size_hint: None, None
            size: dp(80), dp(24)
            font_size: '10sp'
            md_bg_color: app.theme_cls.primary_color if root.status == 'active' else [0.7, 0.7, 0.7, 1]
            text_color: [1, 1, 1, 1] if root.status == 'active' else [0, 0, 0, 1]
    
    MDLabel:
        text: f"${root.total:.2f}"
        font_style: 'H5'
        theme_text_color: 'Primary'
        bold: True
        size_hint_y: None
        height: dp(40)
    
    MDLabel:
        text: root.restaurant if hasattr(root, 'restaurant') else 'Restaurant'
        font_style: 'Caption'
        theme_text_color: 'Secondary'
        size_hint_y: None
        height: dp(20)
        halign: 'right'
